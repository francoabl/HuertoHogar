<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos - HuertoHogar</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="huertohogar-web.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
        <div class="container">
            <a class="navbar-brand" href="huertohogar-web.html">
                <i class="fas fa-seedling me-2"></i>HuertoHogar
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="huertohogar-web.html">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="productos.html">
                            Productos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="nosotros.html">Nosotros</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="contacto.html">Contacto</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="blog.html">Blog</a>
                    </li>
                    
                    <li class="nav-item ms-3">
                        <a class="btn btn-outline-primary" href="login.html">
                            <i class="fas fa-user me-2"></i>Ingresar
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main style="margin-top: 100px; min-height: 80vh;">
        <div class="container">
            <!-- Header -->
            <div class="products-header">
                <h1 class="products-title" id="pageTitle">Nuestros Productos</h1>
                <p class="lead text-muted" id="pageSubtitle">Descubre la frescura del campo chileno</p>
            </div>

            <!-- Category Filters -->
            <div class="category-filter">
                <div class="text-center">
                    <h3 class="mb-3">Filtrar por Categoría</h3>
                    <div class="filter-buttons">
                        <button class="btn filter-btn active" data-categoria="todas">Todas</button>
                        <button class="btn filter-btn" data-categoria="frutas frescas">Frutas Frescas</button>
                        <button class="btn filter-btn" data-categoria="verduras">Verduras Orgánicas</button>
                        <button class="btn filter-btn" data-categoria="organicos">Productos Orgánicos</button>
                        <button class="btn filter-btn" data-categoria="lacteos">Productos Lácteos</button>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div class="loading" id="loadingState">
                <div class="spinner-border text-success" role="status">
                    <span class="visually-hidden">Cargando productos...</span>
                </div>
                <p class="mt-3">Cargando productos frescos...</p>
            </div>

            <!-- Products Grid -->
            <div class="row g-4" id="productsContainer" style="display: none;">
                <!-- Products will be dynamically loaded here -->
            </div>

            <!-- No Products Message -->
            <div class="no-products" id="noProductsMessage" style="display: none;">
                <i class="fas fa-search fa-3x mb-3 text-muted"></i>
                <h3>No se encontraron productos</h3>
                <p>No hay productos disponibles para la categoría seleccionada.</p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer mt-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-4">
                    <h3 class="footer-title">
                        <i class="fas fa-seedling me-2"></i>HuertoHogar
                    </h3>
                    <p class="mb-4">Conectando familias chilenas con la frescura del campo desde hace más de 6 años.</p>
                    <div class="d-flex">
                        <a href="#" class="social-icon">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="social-icon">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="social-icon">
                            <i class="fab fa-twitter"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-2 col-md-6">
                    <h4 class="footer-title">Navegación</h4>
                    <a href="huertohogar-web.html#inicio" class="footer-link">Inicio</a>
                    <a href="productos.html" class="footer-link">Productos</a>
                    <a href="huertohogar-web.html#nosotros" class="footer-link">Nosotros</a>
                    <a href="huertohogar-web.html#contacto" class="footer-link">Contacto</a>
                </div>
                <div class="col-lg-2 col-md-6">
                    <h4 class="footer-title">Productos</h4>
                    <a href="productos.html?categoria=frutas frescas" class="footer-link">Frutas</a>
                    <a href="productos.html?categoria=verduras" class="footer-link">Verduras</a>
                    <a href="productos.html?categoria=organicos" class="footer-link">Orgánicos</a>
                    <a href="productos.html?categoria=lacteos" class="footer-link">Lácteos</a>
                </div>
                <div class="col-lg-4">
                    <h4 class="footer-title">Contacto</h4>
                    <p><i class="fas fa-envelope me-2"></i>contacto@huertohogar.cl</p>
                    <p><i class="fas fa-phone me-2"></i>+56 2 2345 6789</p>
                    <p><i class="fas fa-map-marker-alt me-2"></i>Santiago, Chile</p>
                </div>
            </div>
            <hr style="border-color: rgba(255,255,255,0.2); margin: 2rem 0 1rem;">
            <div class="text-center">
                <p>&copy; 2024 HuertoHogar. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variables globales
        let productos = [];
        let categoriaActual = 'todas';

        // Datos de productos embebidos como fallback
        const productosEmbebidos = {
            "productos": [
                {
                    "id": 1,
                    "nombre": "Manzanas Rojas",
                    "precio": 1200,
                    "categoria": "frutas frescas",
                    "descripcion": "Manzanas rojas frescas y crujientes, directo del huerto",
                    "imagen": "assets/img/productos/manzanas.jpg"
                },
                {
                    "id": 2,
                    "nombre": "Miel Orgánica",
                    "precio": 2500,
                    "categoria": "organicos",
                    "descripcion": "Miel pura y natural de abejas locales, sin procesamientos químicos",
                    "imagen": "assets/img/productos/miel.webp"
                },
                {
                    "id": 3,
                    "nombre": "Leche Fresca",
                    "precio": 1800,
                    "categoria": "lacteos",
                    "descripcion": "Leche fresca de vacas locales, rica en nutrientes",
                    "imagen": "assets/img/productos/leche.webp"
                },
                {
                    "id": 4,
                    "nombre": "Naranjas Dulces",
                    "precio": 1100,
                    "categoria": "frutas frescas",
                    "descripcion": "Naranjas jugosas y dulces, perfectas para jugos naturales",
                    "imagen": "assets/img/productos/naranjas.webp"
                },
                {
                    "id": 5,
                    "nombre": "Espinacas Orgánicas",
                    "precio": 900,
                    "categoria": "verduras",
                    "descripcion": "Espinacas frescas cultivadas sin pesticidas, ricas en hierro",
                    "imagen": "assets/img/productos/espinacas.webp"
                },
                {
                    "id": 6,
                    "nombre": "Zanahorias Frescas",
                    "precio": 800,
                    "categoria": "verduras",
                    "descripcion": "Zanahorias frescas y crujientes, perfectas para ensaladas",
                    "imagen": "assets/img/productos/zanahorias.webp"
                }
            ]
        };

        // Mapeo de categorías para los títulos
        const categoriesTitles = {
            'todas': 'Todos Nuestros Productos',
            'frutas frescas': 'Frutas Frescas',
            'verduras': 'Verduras Orgánicas',
            'organicos': 'Productos Orgánicos',
            'lacteos': 'Productos Lácteos'
        };

        // Función para obtener parámetros de la URL
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            const results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // Función para cargar productos desde JSON
        async function cargarProductos() {
            try {
                console.log('Iniciando carga de productos...');
                
                // Intentar cargar desde archivo JSON primero
                try {
                    const response = await fetch('productos.json');
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    console.log('Datos cargados desde JSON:', data);
                    productos = data.productos;
                } catch (fetchError) {
                    console.log('Error al cargar desde JSON, usando datos embebidos:', fetchError);
                    // Usar datos embebidos como fallback
                    productos = productosEmbebidos.productos;
                    console.log('Usando datos embebidos:', productos);
                }
                
                // Obtener categoría de la URL
                const categoriaUrl = getUrlParameter('categoria');
                if (categoriaUrl && categoriaUrl !== '') {
                    categoriaActual = categoriaUrl;
                    actualizarFiltroActivo(categoriaActual);
                }
                
                mostrarProductos(categoriaActual);
                ocultarLoading();
            } catch (error) {
                console.error('Error crítico al cargar productos:', error);
                mostrarError();
            }
        }

        // Función para mostrar productos filtrados
        function mostrarProductos(categoria) {
            console.log('Mostrando productos para categoría:', categoria);
            console.log('Productos disponibles:', productos);
            
            const container = document.getElementById('productsContainer');
            const noProductsMessage = document.getElementById('noProductsMessage');
            
            // Filtrar productos
            let productosFiltrados;
            if (categoria === 'todas') {
                productosFiltrados = productos;
            } else {
                productosFiltrados = productos.filter(producto => 
                    producto.categoria.toLowerCase() === categoria.toLowerCase()
                );
            }

            console.log('Productos filtrados:', productosFiltrados);

            // Actualizar título
            actualizarTitulo(categoria);

            // Mostrar productos o mensaje de no encontrados
            if (productosFiltrados.length === 0) {
                container.style.display = 'none';
                noProductsMessage.style.display = 'block';
                console.log('No se encontraron productos para la categoría:', categoria);
            } else {
                container.style.display = 'flex';
                noProductsMessage.style.display = 'none';
                
                // Generar HTML de productos
                    container.innerHTML = productosFiltrados.map(producto => `
                        <div class="col-md-6 col-lg-4">
                            <div class="card product-card producto-clickable" data-id="${producto.id}" style="cursor:pointer;">
                                <img src="${producto.imagen}" class="product-image" alt="${producto.nombre}" 
                                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjI1MCIgdmlld0JveD0iMCAwIDMwMCAyNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMjUwIiBmaWxsPSIjZjhmZGY0Ii8+CjxjaXJjbGUgY3g9IjE1MCIgY3k9IjEyNSIgcj0iNDAiIGZpbGw9IiM3Y2IzNDIiIG9wYWNpdHk9IjAuMyIvPgo8dGV4dCB4PSIxNTAiIHk9IjEzNSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE2IiBmaWxsPSIjNmM3NTdkIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5JbWFnZW4gbm8gZGlzcG9uaWJsZTwvdGV4dD4KPC9zdmc+'">
                                <div class="card-body">
                                    <h5 class="card-title">${producto.nombre}</h5>
                                    <p class="text-muted small mb-2">${producto.descripcion || 'Producto fresco de calidad premium'}</p>
                                    <p class="text-muted mb-2"><small>Categoría: ${getCategoriaDisplayName(producto.categoria)}</small></p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="product-price">$${producto.precio.toLocaleString('es-CL')}</span>
                                        <button class="btn btn-success btn-sm">
                                            <i class="fas fa-shopping-cart me-1"></i>Agregar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                
                console.log('Productos mostrados correctamente');
            }
        }

        // Función para obtener nombre de categoría para mostrar
        function getCategoriaDisplayName(categoria) {
            const displayNames = {
                'frutas frescas': 'Frutas Frescas',
                'verduras': 'Verduras Orgánicas',
                'organicos': 'Productos Orgánicos',
                'lacteos': 'Productos Lácteos'
            };
            return displayNames[categoria.toLowerCase()] || categoria;
        }

        // Función para actualizar el título de la página
        function actualizarTitulo(categoria) {
            const pageTitle = document.getElementById('pageTitle');
            const pageSubtitle = document.getElementById('pageSubtitle');
            
            pageTitle.textContent = categoriesTitles[categoria] || 'Nuestros Productos';
            
            if (categoria === 'todas') {
                pageSubtitle.textContent = 'Descubre la frescura del campo chileno';
            } else {
                pageSubtitle.textContent = `Los mejores ${getCategoriaDisplayName(categoria).toLowerCase()} directos del campo`;
            }
        }

        // Función para actualizar filtro activo
        function actualizarFiltroActivo(categoria) {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeBtn = document.querySelector(`[data-categoria="${categoria}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
        }

        // Función para ocultar loading
        function ocultarLoading() {
            document.getElementById('loadingState').style.display = 'none';
        }

        // Función para mostrar error
        function mostrarError() {
            document.getElementById('loadingState').innerHTML = `
                <div class="text-center">
                    <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                    <h3>Error al cargar productos</h3>
                    <p>No se pudieron cargar los productos. Por favor, intenta nuevamente.</p>
                    <button class="btn btn-primary" onclick="location.reload()">Reintentar</button>
                </div>
            `;
        }

        // Event listeners para filtros
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar productos al cargar la página
            cargarProductos();

            // Event listeners para botones de filtro
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const categoria = this.getAttribute('data-categoria');
                    categoriaActual = categoria;
                    // Actualizar filtro activo
                    actualizarFiltroActivo(categoria);
                    // Mostrar productos filtrados
                    mostrarProductos(categoria);
                    // Actualizar URL sin recargar la página
                    const newUrl = categoria === 'todas' ? 'productos.html' : `productos.html?categoria=${encodeURIComponent(categoria)}`;
                    window.history.pushState({categoria: categoria}, '', newUrl);
                });
            });

            // Delegación de evento para productos
            document.getElementById('productsContainer').addEventListener('click', function(e) {
                let card = e.target;
                // Buscar el elemento con la clase producto-clickable
                while (card && !card.classList.contains('producto-clickable')) {
                    card = card.parentElement;
                }
                if (card && card.dataset.id) {
                    window.location.href = `detalle-producto.html?id=${card.dataset.id}`;
                }
            });
        });

        // Manejar navegación del navegador (botón atrás/adelante)
        window.addEventListener('popstate', function(event) {
            if (event.state && event.state.categoria) {
                categoriaActual = event.state.categoria;
                actualizarFiltroActivo(categoriaActual);
                mostrarProductos(categoriaActual);
            }
        });
    </script>
</body>
</html>
